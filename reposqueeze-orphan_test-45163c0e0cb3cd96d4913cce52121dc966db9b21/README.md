# reposqueeze

`reposqueeze` - это мощный инструмент командной строки (CLI), написанный на Go, предназначенный для упрощения создания и управления "сиротскими" ветками (orphan branches) в Git-репозиториях, с акцентом на бесшовную интеграцию с GitLab. Он автоматизирует сложные процессы, связанные с инициализацией новых веток без истории, и позволяет легко переносить содержимое из существующих веток или архивов GitLab.

## Описание

Проект `reposqueeze` решает проблему создания чистых, изолированных веток в Git, которые не имеют общей истории с основной веткой репозитория. Такие "сиротские" ветки часто используются для размещения документации, сгенерированного кода, статических сайтов (например, для GitHub Pages) или других артефактов, которые должны быть частью репозитория, но не связаны с его основной историей разработки.

Основные цели проекта:
*   **Упрощение рабочего процесса:** Предоставление простых команд для выполнения сложных операций Git.
*   **Интеграция с GitLab:** Возможность создавать сиротские ветки, используя данные непосредственно из GitLab.
*   **Гибкость:** Поддержка создания веток как из локальных репозиториев, так и из удаленных источников.
*   **Автоматизация:** Сокращение ручных шагов и потенциальных ошибок при работе с сиротскими ветками.

## Возможности

*   **Создание сиротской ветки из локального репозитория**: Инициализирует новую сиротскую ветку в существующем локальном Git-репозитории. Позволяет опционально скопировать файлы из указанной исходной ветки в новую сиротскую ветку, что удобно для переноса статических ресурсов или начальной конфигурации.
*   **Создание сиротской ветки из GitLab**: Загружает архив всего репозитория из GitLab, создает новую сиротскую ветку в указанном локальном каталоге и распаковывает содержимое архива в эту ветку. Это идеально подходит для создания сиротских веток на основе актуального состояния удаленного репозитория.

## Установка

Для установки `reposqueeze` убедитесь, что у вас установлен Go (версия 1.16 или выше) и Git.

1.  **Клонирование репозитория:**
    ```bash
    git clone https://github.com/your-username/reposqueeze.git
    cd reposqueeze
    ```
    (Замените `your-username` на актуальное имя пользователя или организации)

2.  **Сборка исполняемого файла:**
    ```bash
    go build -o bin/reposqueeze cmd/app/main.go
    ```
    Это создаст исполняемый файл `reposqueeze` в каталоге `bin/`.

3.  **Добавление в PATH (опционально):**
    Для удобства вы можете добавить каталог `bin/` в вашу переменную окружения `PATH`:
    ```bash
    export PATH=$PATH:$(pwd)/bin
    ```
    Для постоянного использования добавьте эту строку в ваш `.bashrc`, `.zshrc` или аналогичный файл конфигурации оболочки.

## Использование

### Создание сиротской ветки из локального репозитория

Эта команда создает новую сиротскую ветку в существующем локальном репозитории. Вы можете указать исходную ветку, из которой будут скопированы файлы.

```bash
reposqueeze create-from-local --repo-path /path/to/your/local/repo --branch-name gh-pages --token your_gitlab_token --from main
```

*   `--repo-path <путь_к_репозиторию>`: **(Обязательно)** Абсолютный или относительный путь к локальному Git-репозиторию.
*   `--branch-name <имя_ветки>`: **(Обязательно)** Имя новой сиротской ветки, например, `gh-pages` или `docs`.
*   `--token <токен_gitlab>`: **(Обязательно)** Персональный токен доступа GitLab с правами `api` и `read_repository`.
*   `--from <исходная_ветка>`: **(Опционально)** Имя существующей ветки, из которой будут скопированы файлы в новую сиротскую ветку. Если не указано, новая ветка будет пустой.

**Пример:**
```bash
# Создание пустой сиротской ветки 'docs' в текущем репозитории
reposqueeze create-from-local --repo-path . --branch-name docs --token ghp_xxxxxxxxxxxxxxxxxxxx

# Создание сиротской ветки 'gh-pages' с файлами из ветки 'main'
reposqueeze create-from-local --repo-path /home/user/my-project --branch-name gh-pages --token ghp_xxxxxxxxxxxxxxxxxxxx --from main
```

### Создание сиротской ветки из GitLab

Эта команда загружает архив репозитория из GitLab, создает сиротскую ветку в указанном локальном каталоге и распаковывает в нее содержимое архива.

```bash
reposqueeze create-from-gitlab --repo-path /path/to/new/local/repo --branch-name gh-pages --token your_gitlab_token --project-id 12345 --gitlab-url https://gitlab.com
```

*   `--repo-path <путь_к_репозиторию>`: **(Обязательно)** Путь к локальному каталогу, где будет инициализирован новый репозиторий, загружен архив GitLab и создана сиротская ветка.
*   `--branch-name <имя_ветки>`: **(Обязательно)** Имя новой сиротской ветки.
*   `--token <токен_gitlab>`: **(Обязательно)** Персональный токен доступа GitLab с правами `api` и `read_repository`.
*   `--project-id <идентификатор_проекта>`: **(Обязательно)** Числовой идентификатор проекта GitLab.
*   `--gitlab-url <URL_GitLab>`: **(Опционально)** Базовый URL вашего экземпляра GitLab (по умолчанию `https://gitlab.com`).

**Пример:**
```bash
# Создание сиротской ветки 'builds' из GitLab проекта с ID 54321
reposqueeze create-from-gitlab --repo-path /tmp/my-builds --branch-name builds --token ghp_xxxxxxxxxxxxxxxxxxxx --project-id 54321
```

## Переменные окружения

`reposqueeze` может использовать переменные окружения для конфигурации.

*   `GITLAB_TOKEN`: **(Обязательно)** Ваш персональный токен доступа GitLab. Используется для аутентификации при взаимодействии с GitLab API.
    *   Пример: `export GITLAB_TOKEN="ghp_xxxxxxxxxxxxxxxxxxxx"`
*   `GITLAB_BASE_URL`: **(Опционально)** Базовый URL вашего экземпляра GitLab. Если не указан, по умолчанию используется `https://gitlab.com`.
    *   Пример: `export GITLAB_BASE_URL="https://your-private-gitlab.com"`

Рекомендуется использовать переменные окружения для хранения конфиденциальных данных, таких как токены, чтобы избежать их жесткого кодирования в скриптах или командной строке.

## Структура проекта

Проект `reposqueeze` организован в соответствии с общими рекомендациями для Go-проектов:

```
reposqueeze/
├── cmd/
│   └── app/
│       └── main.go           # Точка входа в приложение, обработка CLI команд
├── internal/
│   ├── app/
│   │   ├── controller/
│   │   │   └── cli_controller.go # Обработка логики CLI команд
│   │   └── usecase/
│   │       ├── create_branch.go  # Логика создания обычной ветки
│   │       └── create_orphan_branch_from_gitlab.go # Логика создания сиротской ветки из GitLab
│   ├── domain/
│   │   ├── entity/
│   │   │   ├── branch.go     # Определение сущности ветки
│   │   │   ├── gitlab.go     # Определение сущностей GitLab (например, проект)
│   │   │   └── repository.go # Определение сущности репозитория
│   │   └── gateway/
│   │       ├── git_gateway.go    # Интерфейс для взаимодействия с Git
│   │       └── gitlab_gateway.go # Интерфейс для взаимодействия с GitLab API
│   ├── infrastructure/
│   │   ├── git/
│   │   │   └── os_exec_git.go    # Реализация Git Gateway с использованием os/exec
│   │   └── gitlab/
│   │       └── http_gitlab.go    # Реализация GitLab Gateway с использованием HTTP
│   └── pkg/
│       └── logger/
│           └── logger.go     # Пакет для логирования
├── go.mod                    # Модуль Go
├── go.sum                    # Контрольные суммы зависимостей
├── Makefile                  # Скрипты для сборки и тестирования
├── README.md                 # Этот файл
└── bin/                      # Каталог для скомпилированных бинарных файлов
    └── reposqueeze           # Исполняемый файл
```

*   **`cmd/`**: Содержит основные исполняемые приложения. `cmd/app/main.go` является точкой входа для CLI.
*   **`internal/`**: Содержит приватный код приложения, который не предназначен для импорта другими проектами.
    *   **`app/`**: Содержит логику приложения, включая контроллеры и варианты использования (use cases).
    *   **`domain/`**: Определяет основные бизнес-сущности, агрегаты и интерфейсы (шлюзы/репозитории).
    *   **`infrastructure/`**: Содержит реализации внешних зависимостей, таких как Git-команды и GitLab API-клиенты.
    *   **`pkg/`**: Содержит пакеты, которые могут быть использованы в любом месте проекта.
*   **`bin/`**: Каталог для скомпилированных бинарных файлов.

## Вклад

Мы приветствуем любой вклад в проект `reposqueeze`! Если вы хотите внести свой вклад, пожалуйста, следуйте этим рекомендациям:

1.  **Форкните репозиторий:** Начните с форка репозитория на GitHub.
2.  **Создайте новую ветку:** Создайте новую ветку для ваших изменений: `git checkout -b feature/your-feature-name` или `git checkout -b bugfix/your-bug-fix`.
3.  **Внесите изменения:** Реализуйте свои изменения, следуя существующему стилю кодирования.
4.  **Напишите тесты:** Убедитесь, что ваши изменения покрыты соответствующими тестами.
5.  **Запустите тесты:** Перед отправкой убедитесь, что все тесты проходят: `go test ./...`
6.  **Зафиксируйте изменения:** Напишите четкое и информативное сообщение коммита: `git commit -m "feat: Add new feature"`.
7.  **Отправьте изменения:** Отправьте вашу ветку в ваш форк: `git push origin feature/your-feature-name`.
8.  **Создайте Pull Request:** Откройте Pull Request в основной репозиторий. Опишите ваши изменения, их цель и любые связанные проблемы.

Мы ценим ваше время и усилия!